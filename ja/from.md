# from関数

from関数は単純にファイルを取り込むだけではなく、プログラムから扱いやすい形式に変換することが出来ます。  

## 書式

byte[] foo = from(ファイル名, [, "コンバータ名"][, "オプション"]);

- ファイル名
  指定したファイル名がロードされ、コンバータ―に渡されます。
  BMP(Indexed Color)ファイルの場合、画像データとして変換されたイメージがコンバータに渡されます。

- コンバータ名  
  スクリプト名を指定します。以下のコンバータが用意されています。
  - sc1  
  BMPデータをMSXのSCREEN1のパターン(&カラー)データに変換する。
  - sc2  
  BMPデータをMSXのSCREEN2のパターン(&カラー)データに変換する。
  - sp1x16  
  BMPデータをMSXのスプライトモード1、サイズ16のパターン(&カラー)データに変換する。
  - pack  
  ファイルを普通のバイナリとして読み込み、圧縮します。

- オプション  
  変数名1=値, 変数名2=値, ...の形式で指定します。  

## コンバータについて

## pack
ファイルを普通のバイナリとして読み込み、圧縮します。  
圧縮方法をオプションで指定します。  
RLEの仕組みはWikiなどを参考にしてください。  

### オプション
  - pack
    圧縮形式を指定します。

    - RLE  
      RLE圧縮します。  
      フォーマットは以下のようになっています。
      |項目    |サイズ  | 意味                                           |
      |:-------|-------:|:-----------------------------------------------|
      |データ長| 1      | 連続するデータ長、0 ～ 255。                   |
      |値      | 1      | 繰り返されるデータが指定されています。         |
      |        |        | 以降データの終わりまで繰り返されます。         |

    - PRLE  
      PackBits RLE圧縮します。  
      フォーマットは以下のようになっています。
      |項目    |サイズ    | 意味                                                                       |
      |:-------|---------:|:---------------------------------------------------------------------------|
      |データ長| 1        | データ長、0 ～ 127は連続するデータ、-1 ～ -128は不連続のデータを表します。 |
      |値      | 1 ～ 128 | 連続データの場合、繰り返されるデータが指定されています。<br/>非連続データの場合、データ長分のデータが格納されています。 |
      |        |          | 以降データの終わりまで繰り返されます。                                     |

    - SRLE  
      Switched RLE圧縮します。  
      フォーマットは以下のようになっています。
      |項目    |サイズ    | 意味                                                                       |
      |:-------|---------:|:---------------------------------------------------------------------------|
      |データ長| 1        | データ長、0 ～ 255は連続するデータ。最初は非連続データから始まります。|
      |値      | 1 ～ 255 | 連続データの場合、繰り返されるデータが指定されています。<br/>非連続データの場合、データ長分のデータが格納されています。 |
      |        |          | 以降データの終わりまで繰り返されます。                                     |

    - BPE  
      Bit Pair Encoding圧縮します。  
      フォーマットは以下のようになっています。
      |項目        |サイズ    | 意味                                                                          |
      |:-----------|---------:|:------------------------------------------------------------------------------|
      |ペア辞書数  | 1        | ペア辞書数。                                                                  |
      |ペア辞書    |          | 下記構造がペア辞書数分繰り返されます。                                        |
      | - ペア対象 | 1        | 置換対象のコード値                                                            |
      | - ペア1    | 1        | ペアの1番目のコード値                                                         |
      | - ペア2    | 1        | ペアの2目のコード値                                                           |
      |データ長    | 2        | データ部の長さ                                                                |
      |データ      | 1 ～ n   | データ長分のデータが格納されています。                                        |
      |            |          | 以降データの終わりまで繰り返されます。                                        |

## sc1
BMPデータをMSXのSCREEN1のパターンジェネレータテーブルとカラーテーブル形式のデータに変換します。  
パターンに対応するカラーテーブルのデータは、パターンデータの後ろに連結されます。  
例として256x64のBMPの場合は  
- 256パターン定義できる
- パターンデータは8バイト * 256 = 2048バイト
- パターン定義した場合、使用するカラーテーブルは32バイト
- 2048バイト目から32バイトがカラーテーブルとなる

### オプション
- pack  
  packコンバータ―に渡すオプションを指定します

## sc2
BMPデータをMSXのSCREEN2のパターンジェネレータテーブルとカラーテーブル形式のデータに変換します。  
パターンジェネレータテーブルはsc1と同じですが、カラーテーブルは1パターン、1ライン毎に設定できます。
例として256x128のBMPの場合は  
- 512パターン定義できる
- パターンデータは8バイト * 512 = 4096バイト
- 使用するカラーテーブルは1パターン8バイト使用するので 8 * 512 = 4096バイト
- 4096バイト目から4096バイトがカラーテーブルとなる

### オプション
- pack  
  packコンバータ―に渡すオプションを指定します

## sp1x16
BMPデータをMSXのスプライトモード1のパターンテーブルのデータに変換します。  
8x8サイズのデータ(8バイト)を1セットとして、連続する4つのセットを組み合わせて16x16のスプライトを定義します。  
スプライトデータが終了すると、次にスプライトのパターン番号に対応するカラーコードが格納されています。

### オプション
- pack  
  packコンバータ―に渡すオプションを指定します

## カスタムコンバータ
自作のコンバータを定義することが出来ます。
コマンドパレットから`xsm converter`を実行すると、カスタムコンバータ―のテンプレートを生成されます。
